<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD Alumnos</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
    <div class="container mt-5">
        <h2 class="text-center mb-4">Registro de Alumnos</h2>

        <!-- formulario -->
         <form id="formAlumno" class="card p-4 shadow">
            <input type="hidden" id="idAlumno">

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label>Nombre</label>
                    <input type="text" id="nombre" class="form-control" required>
                </div>

                <div class="col-md-6 mb-3">
                    <label>Apellido</label>
                    <input type="text" id="apellido" class="form-control" required>
                </div>

                <div class="col-md-6 mb-3">
                    <label>Teléfono</label>
                    <input type="text" id="telefono" class="form-control" required>
                </div>

                <div class="col-md-6 mb-3">
                    <label>Dirección</label>
                    <input type="text" id="direccion" class="form-control" required>
                </div>
                             
            </div>

            <button class="btn btn-outline-primary" type="submit" id="btnGuardar">Guardar</button>
            <button class="btn btn-outline-success d-none" type="button" id="btnActualizar">Actualizar</button>
            <button class="btn btn-outline-secondary d-none" type="button" id="btnCancelar">Cancelar</button>
         </form>

        <!-- tabla -->
         <h3 class="text-center mt-5">Listado de Alumnos</h3>

         <table class="table table-striped mt-3">
            <thead>
                <tr>
                    <th>ID</th><th>Nombre</th><th>Apellido</th><th>Teléfono</th><th>Dirección</th><th>Acciones</th>
                </tr>
            </thead>
            <tbody id="tablaBody"></tbody>
         </table>
    </div>

    <script>
        // URL API Backend
        const API = "http://localhost:3000/alumnos";

        // cargar alumnos
        async function cargarAlumnos() {
            try {
                const res = await fetch(API);
                const alumnos = await res.json();

                let html = "";
                alumnos.forEach(a => {
                    html += `
                        <tr>
                            <td>${a.id}</td>
                            <td>${a.nombre}</td>
                            <td>${a.apellido}</td>
                            <td>${a.telefono}</td>
                            <td>${a.direccion}</td>
                            <td>
                                <button class="btn btn-outline-warning btn-sm"
                                onclick="editar(${a.id}, '${a.nombre}', '${a.apellido}', '${a.telefono}', '${a.direccion}')"> 
                                Editar
                                </button>
                                <button class="btn btn-danger btn-sm"
                                onclick="eliminarAlumno(${a.id})"> 
                                Eliminar
                                </button>
                            </td>
                        </tr>
                    `;
                });

                document.getElementById("tablaBody").innerHTML = html;
            }
            catch (error){
                console.error("Error cargando alumnos:", error);
            }
        }
        cargarAlumnos();

        // guardar alumno
        document.getElementById("formAlumno").addEventListener("submit", async (e) =>{
            e.preventDefault();

            const data = {
                nombre: nombre.value,
                apellido: apellido.value,
                telefono: telefono.value,
                direccion: direccion.value,
            };

            await fetch(API, {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify(data)
            })

            cargarAlumnos();
            e.target.reset();
        })

        // eliminar alumno
        async function eliminarAlumno(id) {
            // await fetch("http://localhost:3000/alumnos/1")
            await fetch(`${API}/${id}`, {method: "DELETE"});
            cargarAlumnos();    
        }

        // activar modo edicion
        function editar(id, nombreVal, apellidoVal, telefonoVal, direccionVal){
            idAlumno.value = id;
            nombre.value = nombreVal;
            apellido.value = apellidoVal;
            telefono.value = telefonoVal;
            direccion.value = direccionVal;

            btnGuardar.classList.add("d-none");
            btnActualizar.classList.remove("d-none");
            btnCancelar.classList.remove("d-none");
        }

        // actualizar alumno
        btnActualizar.addEventListener("click", async () => {

            const data = {
                nombre: nombre.value,
                apellido: apellido.value,
                telefono: telefono.value,
                direccion: direccion.value,
            };

            const id = idAlumno.value;

            await fetch(`${API}/${id}`, 
            {
                method: "PUT",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify(data)
            });

            cargarAlumnos();

            btnGuardar.classList.remove("d-none");
            btnActualizar.classList.add("d-none");
            btnCancelar.classList.add("d-none");
        })

        // cancelar edicion
        btnCancelar.addEventListener("click", ()=>{
            formAlumno.reset()

            btnGuardar.classList.remove("d-none");
            btnActualizar.classList.add("d-none");
            btnCancelar.classList.add("d-none");
        })

 cargarAlumnos();



    
   // Validaciones por parte del forntend


 
// VALIDACIONES SENCILLAS

function validarFormulario() {

    // Campos vacíos obligarlos a llenar
    if (
        nombre.value === "" ||
        apellido.value === "" ||
        telefono.value === "" ||
        direccion.value === ""
    ) {
        alert("Completa todos los campos");
        return false;
    }

    //Nombre minimo 3 letras
    if (nombre.value.length < 3) {
        alert("El nombre debe tener al menos 3 letras");
        return false;
    }

    // Apellido minimo 3 letras
    if (apellido.value.length < 3) {
        alert("El apellido debe tener al menos 3 letras");
        return false;
    }

    //Nombre sin numeros
    for (let i = 0; i < nombre.value.length; i++) {
        if (!isNaN(nombre.value[i])) {
            alert("El nombre no debe tener números");
            return false;
        }
    }

    //Apellido sin numeros
    for (let i = 0; i < apellido.value.length; i++) {
        if (!isNaN(apellido.value[i])) {
            alert("El apellido no debe tener números");
            return false;
        }
    }

    //Teléfono solo numeros
    if (isNaN(telefono.value)) {
        alert("El teléfono solo debe tener números");
        return false;
    }

    // Telefono mínimo 8 numeros
    if (telefono.value.length < 8) {
        alert("El teléfono debe tener al menos 8 números");
        return false;
    }

    // Dirección minima
    if (direccion.value.length < 5) {
        alert("La dirección debe tener al menos 5 caracteres");
        return false;
    }

    //si  Todo bien
    return true;
}

// Validar al guardar

formAlumno.addEventListener("submit", function (e) {
    e.preventDefault();

    if (!validarFormulario()) {
        return;
    }
});

// Validar al actualizar

btnActualizar.addEventListener("click", function () {
    if (!validarFormulario()) {
        return;
    }
});



    
</script>

</body>
</html>